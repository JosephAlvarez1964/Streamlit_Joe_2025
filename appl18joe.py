import streamlit as st
from openai import OpenAI

st.sidebar.title("ðŸ’¬ Chatbot con contexto desde archivo")

st.sidebar.write("Este es el sidebar")
st.sidebar.image(data:image/png;base64,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)
openai_api_key = st.secrets["api_key"]
client = OpenAI(api_key=openai_api_key)

# Subida del archivo de texto
archivo = st.file_uploader("Sube un archivo .txt con el contexto", type="txt")
if archivo is None:
    st.info("ðŸ’¡ Esperando archivo...")
    st.stop()

# Leer contenido del archivo
contexto_local = archivo.read().decode("utf-8")

# Entrada del usuario
prompt = st.chat_input("Haz tu pregunta sobre modelos GPT...")
if prompt is None:
    st.stop()

# Mostrar entrada del usuario
with st.chat_message("user", avatar="ðŸ¦–"):
    st.markdown(prompt)

# Consulta a OpenAI con el contexto
stream = client.chat.completions.create(
    model="gpt-4o-mini",
    messages=[
        {"role": "system", "content": f"Usa el siguiente contexto para responder:\n\n{contexto_local}"},
        {"role": "user", "content": prompt}
    ],
    max_tokens=800,
    temperature=0,
)

respuesta = stream.choices[0].message.content
with st.chat_message("assistant"):
    st.write(respuesta)
